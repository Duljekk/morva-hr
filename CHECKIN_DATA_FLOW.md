# ğŸ“Š Check-In/Check-Out Data Flow Visualization

## Complete System Architecture

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         FRONTEND (Browser)                          â”‚
â”‚                          app/page.tsx                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                  â†•
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      SERVER ACTIONS (Next.js)                       â”‚
â”‚                    lib/actions/attendance.ts                        â”‚
â”‚                                                                     â”‚
â”‚  â€¢ getTodaysAttendance()                                            â”‚
â”‚  â€¢ checkIn()                                                        â”‚
â”‚  â€¢ checkOut()                                                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                  â†•
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    SUPABASE CLIENT (Server-Side)                    â”‚
â”‚                       lib/supabase/server.ts                        â”‚
â”‚                                                                     â”‚
â”‚  â€¢ Manages authentication cookies                                   â”‚
â”‚  â€¢ Enforces Row Level Security (RLS)                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                  â†•
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    SUPABASE DATABASE (PostgreSQL)                   â”‚
â”‚                                                                     â”‚
â”‚  Table: attendance_records                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚ id (UUID)                                                  â”‚    â”‚
â”‚  â”‚ user_id (UUID) â†’ References auth.users                     â”‚    â”‚
â”‚  â”‚ date (DATE)                                                â”‚    â”‚
â”‚  â”‚ check_in_time (TIMESTAMPTZ)                                â”‚    â”‚
â”‚  â”‚ check_out_time (TIMESTAMPTZ)                               â”‚    â”‚
â”‚  â”‚ check_in_status (ENUM: 'ontime', 'late')                   â”‚    â”‚
â”‚  â”‚ check_out_status (ENUM: 'ontime', 'overtime', 'leftearly') â”‚    â”‚
â”‚  â”‚ shift_start_hour (INTEGER)                                 â”‚    â”‚
â”‚  â”‚ shift_end_hour (INTEGER)                                   â”‚    â”‚
â”‚  â”‚ total_hours (NUMERIC)                                      â”‚    â”‚
â”‚  â”‚ overtime_hours (NUMERIC)                                   â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ”„ Detailed Flow: Check-In

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ STEP 1: User clicks "Check-In" button                           â”‚
â”‚ Location: Frontend (app/page.tsx)                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ handleCheckIn() executes                                         â”‚
â”‚ â€¢ Sets isLoading = true                                          â”‚
â”‚ â€¢ Disables button (shows "Processing...")                        â”‚
â”‚ â€¢ Calls: await checkIn()                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ STEP 2: Server Action receives request                          â”‚
â”‚ Location: lib/actions/attendance.ts                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ checkIn() server action:                                         â”‚
â”‚                                                                  â”‚
â”‚ 1. const supabase = await createClient()                        â”‚
â”‚    â†’ Creates authenticated Supabase client                       â”‚
â”‚                                                                  â”‚
â”‚ 2. const { user } = await supabase.auth.getUser()               â”‚
â”‚    â†’ Gets current logged-in user                                 â”‚
â”‚    â†’ Validates: user exists (else return error)                  â”‚
â”‚                                                                  â”‚
â”‚ 3. const userData = await supabase                              â”‚
â”‚      .from('users')                                              â”‚
â”‚      .select('shift_start_hour, shift_end_hour')                 â”‚
â”‚      .eq('id', user.id)                                          â”‚
â”‚    â†’ Gets user's shift schedule                                  â”‚
â”‚                                                                  â”‚
â”‚ 4. Calculate Status:                                             â”‚
â”‚    const now = new Date()                                        â”‚
â”‚    const shiftStart = new Date()                                 â”‚
â”‚    shiftStart.setHours(userData.shift_start_hour, 0, 0, 0)      â”‚
â”‚                                                                  â”‚
â”‚    if (now > shiftStart) {                                       â”‚
â”‚      status = 'late'                                             â”‚
â”‚    } else {                                                      â”‚
â”‚      status = 'ontime'                                           â”‚
â”‚    }                                                             â”‚
â”‚                                                                  â”‚
â”‚ 5. Insert into Database:                                         â”‚
â”‚    await supabase                                                â”‚
â”‚      .from('attendance_records')                                 â”‚
â”‚      .insert({                                                   â”‚
â”‚        user_id: user.id,                                         â”‚
â”‚        date: '2025-01-07',  // Today                             â”‚
â”‚        check_in_time: '2025-01-07T11:15:00.000Z',               â”‚
â”‚        check_in_status: 'late',                                  â”‚
â”‚        shift_start_hour: 11,                                     â”‚
â”‚        shift_end_hour: 19                                        â”‚
â”‚      })                                                          â”‚
â”‚                                                                  â”‚
â”‚ 6. revalidatePath('/')                                           â”‚
â”‚    â†’ Tells Next.js to refresh the page data                      â”‚
â”‚                                                                  â”‚
â”‚ 7. return { data: insertedRecord }                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ STEP 3: Database operation                                       â”‚
â”‚ Location: Supabase PostgreSQL                                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Database executes:                                               â”‚
â”‚                                                                  â”‚
â”‚ 1. Row Level Security check:                                     â”‚
â”‚    â†’ Verifies user is authenticated                              â”‚
â”‚    â†’ Checks RLS policy allows insert                             â”‚
â”‚                                                                  â”‚
â”‚ 2. UNIQUE constraint check:                                      â”‚
â”‚    â†’ Ensures no existing record for (user_id, date)              â”‚
â”‚                                                                  â”‚
â”‚ 3. INSERT operation:                                             â”‚
â”‚    INSERT INTO attendance_records (                              â”‚
â”‚      id,                                                         â”‚
â”‚      user_id,                                                    â”‚
â”‚      date,                                                       â”‚
â”‚      check_in_time,                                              â”‚
â”‚      check_in_status,                                            â”‚
â”‚      shift_start_hour,                                           â”‚
â”‚      shift_end_hour,                                             â”‚
â”‚      created_at,                                                 â”‚
â”‚      updated_at                                                  â”‚
â”‚    ) VALUES (                                                    â”‚
â”‚      gen_random_uuid(),                                          â”‚
â”‚      '123e4567-e89b-12d3-a456-426614174000',                     â”‚
â”‚      '2025-01-07',                                               â”‚
â”‚      '2025-01-07T11:15:00.000Z',                                 â”‚
â”‚      'late',                                                     â”‚
â”‚      11,                                                         â”‚
â”‚      19,                                                         â”‚
â”‚      now(),                                                      â”‚
â”‚      now()                                                       â”‚
â”‚    ) RETURNING *;                                                â”‚
â”‚                                                                  â”‚
â”‚ 4. Trigger executes:                                             â”‚
â”‚    â†’ update_updated_at_column() updates timestamp                â”‚
â”‚                                                                  â”‚
â”‚ 5. Returns inserted row                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ STEP 4: Response travels back to frontend                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ handleCheckIn() receives result:                                 â”‚
â”‚                                                                  â”‚
â”‚ if (result.data) {                                               â”‚
â”‚   setCheckInDateTime(new Date(result.data.check_in_time))       â”‚
â”‚   â†’ Updates React state                                          â”‚
â”‚   â†’ UI re-renders                                                â”‚
â”‚ }                                                                â”‚
â”‚                                                                  â”‚
â”‚ setIsLoading(false)                                              â”‚
â”‚ â†’ Button re-enabled                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ STEP 5: UI updates                                               â”‚
â”‚                                                                  â”‚
â”‚ â€¢ Widget shows: "You're On The Clock"                            â”‚
â”‚ â€¢ Check-In Card shows: "11:15" with "Late" badge                 â”‚
â”‚ â€¢ Check-Out button becomes enabled                               â”‚
â”‚ â€¢ Timer starts counting elapsed time                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ”„ Detailed Flow: Check-Out

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ STEP 1: User clicks "Check-Out" button                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ handleCheckOutRequest() executes                                 â”‚
â”‚ â€¢ Shows confirmation modal                                       â”‚
â”‚ â€¢ "Are you sure you want to check out now?"                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ User clicks "Confirm" in modal                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ handleCheckOut() executes                                        â”‚
â”‚ â€¢ Sets isLoading = true                                          â”‚
â”‚ â€¢ Calls: await checkOut()                                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ STEP 2: Server Action processes checkout                        â”‚
â”‚ Location: lib/actions/attendance.ts                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ checkOut() server action:                                        â”‚
â”‚                                                                  â”‚
â”‚ 1. Authenticate user                                             â”‚
â”‚    const { user } = await supabase.auth.getUser()               â”‚
â”‚                                                                  â”‚
â”‚ 2. Get today's attendance record:                                â”‚
â”‚    const attendance = await supabase                             â”‚
â”‚      .from('attendance_records')                                 â”‚
â”‚      .select('*')                                                â”‚
â”‚      .eq('user_id', user.id)                                     â”‚
â”‚      .eq('date', today)                                          â”‚
â”‚      .single()                                                   â”‚
â”‚                                                                  â”‚
â”‚    Validates:                                                    â”‚
â”‚    â€¢ Record exists (checked in today)                            â”‚
â”‚    â€¢ check_out_time is NULL (not already checked out)            â”‚
â”‚                                                                  â”‚
â”‚ 3. Calculate check-out status:                                   â”‚
â”‚    const now = new Date()                                        â”‚
â”‚    const shiftEnd = new Date()                                   â”‚
â”‚    shiftEnd.setHours(attendance.shift_end_hour, 0, 0, 0)        â”‚
â”‚                                                                  â”‚
â”‚    if (now < shiftEnd) {                                         â”‚
â”‚      status = 'leftearly'                                        â”‚
â”‚    } else if (now === shiftEnd) {                                â”‚
â”‚      status = 'ontime'                                           â”‚
â”‚    } else {                                                      â”‚
â”‚      status = 'overtime'                                         â”‚
â”‚    }                                                             â”‚
â”‚                                                                  â”‚
â”‚ 4. Calculate hours:                                              â”‚
â”‚    const checkInDate = new Date(attendance.check_in_time)        â”‚
â”‚    const totalMs = now - checkInDate                             â”‚
â”‚    const totalHours = totalMs / (1000 * 60 * 60)                â”‚
â”‚                                                                  â”‚
â”‚    Expected shift: 8 hours (19 - 11)                             â”‚
â”‚    Overtime = max(0, totalHours - 8)                             â”‚
â”‚                                                                  â”‚
â”‚ 5. Update database:                                              â”‚
â”‚    await supabase                                                â”‚
â”‚      .from('attendance_records')                                 â”‚
â”‚      .update({                                                   â”‚
â”‚        check_out_time: '2025-01-07T19:30:00.000Z',              â”‚
â”‚        check_out_status: 'overtime',                             â”‚
â”‚        total_hours: 8.25,                                        â”‚
â”‚        overtime_hours: 0.25                                      â”‚
â”‚      })                                                          â”‚
â”‚      .eq('id', attendance.id)                                    â”‚
â”‚                                                                  â”‚
â”‚ 6. return { data: updatedRecord }                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ STEP 3: Database UPDATE operation                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ UPDATE attendance_records                                        â”‚
â”‚ SET                                                              â”‚
â”‚   check_out_time = '2025-01-07T19:30:00.000Z',                  â”‚
â”‚   check_out_status = 'overtime',                                 â”‚
â”‚   total_hours = 8.25,                                            â”‚
â”‚   overtime_hours = 0.25,                                         â”‚
â”‚   updated_at = now()                                             â”‚
â”‚ WHERE                                                            â”‚
â”‚   id = '...'                                                     â”‚
â”‚   AND user_id = '...'  -- RLS enforces this                      â”‚
â”‚ RETURNING *;                                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ STEP 4: UI updates with checkout data                           â”‚
â”‚                                                                  â”‚
â”‚ setCheckOutDateTime(new Date(result.data.check_out_time))       â”‚
â”‚ setShowCheckOutConfirm(false)  // Close modal                    â”‚
â”‚ setIsLoading(false)                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ STEP 5: Final UI state                                          â”‚
â”‚                                                                  â”‚
â”‚ â€¢ Widget shows: "You've Checked Out"                             â”‚
â”‚ â€¢ Display: "8h 15m" (total time worked)                          â”‚
â”‚ â€¢ Check-In Card: "11:15" - "Late"                                â”‚
â”‚ â€¢ Check-Out Card: "19:30" - "Overtime: 30m"                      â”‚
â”‚ â€¢ Both buttons disabled                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ”’ Security Layer Breakdown

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    SECURITY CHECKS                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

1. Authentication (Supabase Auth)
   â”œâ”€ User must have valid JWT token
   â”œâ”€ Token verified on every request
   â””â”€ Expired tokens rejected

2. Row Level Security (RLS)
   â”œâ”€ Users table: users can only read their own profile
   â”œâ”€ Attendance table: users can only CRUD their own records
   â””â”€ Admins can read all records (for future reports)

3. Server-Side Validation
   â”œâ”€ All time calculations happen on server
   â”œâ”€ Client cannot fake timestamps
   â”œâ”€ Client cannot manipulate status
   â””â”€ Client cannot modify other users' data

4. Database Constraints
   â”œâ”€ UNIQUE (user_id, date): prevents duplicate check-ins
   â”œâ”€ NOT NULL: ensures required fields
   â”œâ”€ FOREIGN KEY: ensures user exists
   â””â”€ CHECK constraints: validate data integrity

5. Input Validation
   â”œâ”€ User ID validated against auth session
   â”œâ”€ Date format validated
   â”œâ”€ Timestamps validated
   â””â”€ Status enums validated
```

---

## ğŸ“Š Data Persistence

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              WHAT HAPPENS WHEN...                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Scenario 1: Page Refresh
â”œâ”€ useEffect runs on mount
â”œâ”€ Calls getTodaysAttendance()
â”œâ”€ Fetches from database
â”œâ”€ Restores check-in/out state
â””â”€ UI shows current state

Scenario 2: User Logs Out
â”œâ”€ Attendance data stays in database
â”œâ”€ Auth session cleared
â””â”€ Next login: data persists

Scenario 3: Browser Close
â”œâ”€ No effect on database
â”œâ”€ Reopen browser
â”œâ”€ Login again
â””â”€ Previous attendance restored

Scenario 4: Network Error
â”œâ”€ Server action returns error
â”œâ”€ UI shows error message
â”œâ”€ No database changes made
â””â”€ User can retry

Scenario 5: Concurrent Requests
â”œâ”€ Database UNIQUE constraint prevents duplicates
â”œâ”€ Only first check-in succeeds
â””â”€ Second attempt returns error
```

---

## ğŸ¯ Key Takeaways

1. **Frontend** (React/Next.js)
   - Manages UI state
   - Calls server actions
   - Displays data to user

2. **Server Actions** (Next.js API)
   - Business logic
   - Authentication
   - Database operations
   - Calculations

3. **Supabase** (PostgreSQL)
   - Data persistence
   - Row Level Security
   - Data integrity
   - Relationships

4. **Flow Direction**
   - User â†’ Frontend â†’ Server Action â†’ Supabase â†’ Database
   - Response travels back: Database â†’ Supabase â†’ Server Action â†’ Frontend â†’ UI Update

5. **Security Model**
   - Authentication at every layer
   - Server-side validation
   - RLS in database
   - No client-side manipulation possible



